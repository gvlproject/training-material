<!DOCTYPE html>
<html>






  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Tool Shed: sharing Galaxy tools</title>
    <link rel="stylesheet" href="/training-material/assets/css/slides.css">
    <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css" id="theme">
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

<div class="my-footer"><span>

<img src="/training-material/assets/images/GTN-60px.png" alt="Galaxy Training Network" style="height: 40px;">

</span></div>

---

# Tool Shed: sharing Galaxy tools



---





### <img class="emoji" title=":grey_question:" alt=":grey_question:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2754.png" height="20" width="20"> Questions


- What is a Tool Shed?

- How to install tools and workflows from a Tool Shed into a Galaxy instance?

- What are the Tool Shed repository types?

- How to publish with Planemo?


---

### <img class="emoji" title=":dart:" alt=":dart:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f3af.png" height="20" width="20"> Objectives


- Discover what is a Tool Shed

- Be able to install tools and workflows from a Tool Shed into a Galaxy instance

- Be able to publish tools with Planemo


---

## 1. What is a Tool Shed?

![](../../images/toolShed.jpg)

---

### ![](../../images/toolShed.jpg) = Galaxy App Store

---

### ![](../../images/toolShed.jpg) = Galaxy App Store

- Galaxy tools
- ~~Recipes for installing and compilling tools~~,
- Data Managers,
- Custom datatypes,
- Exported workflows.

---

### ![](../../images/toolShed.jpg) = Galaxy App Store

- For Galaxy administrators, facilitates:
  - **installing/updating** tools

- For tool developers, facilitates:
  - **sharing** of Galaxy utilities
  - **versioning**

---

### Available Tool Sheds

- [Galaxy community Tool Shed](https://toolshed.g2.bx.psu.edu/) -&gt; Main Tool Shed
- [Galaxy community test Tool Shed](https://testtoolshed.g2.bx.psu.edu/) -&gt; Sandbox for testing
- [List of public Tool Sheds](https://wiki.galaxyproject.org/PublicGalaxyServers#Public_ToolSheds)

---

### Tool Shed interface

![](../../images/main_toolShed_ss.png)

---

### Example of tool

![](../../images/exampletool_ss.png)

---

## 2. Installing tools from a Tool Shed

---

### Connect your Galaxy to a Tool Shed

- Only for third party toolsheds (Main and Test by default)
- In `config/tool_sheds_conf.xml`:
```bash
  &lt;tool_sheds&gt;
    &lt;tool_shed name="Galaxy main tool shed" url="https://toolshed.g2.bx.psu.edu/" /&gt;
  &lt;/tool_sheds&gt;
```
- Restart Galaxy

---

### Install a tool from the Tool Shed

- Go to the admin interface and click on "Search Tool Shed"
![](../../images/admin_searchtoolshed_ss.png)
- Select a Tool Shed

![](../../images/goToToolshed_ss.png)

---

### Install a tool from the Tool Shed

- Search your tool
![](../../images/searchTool_ss.png)

---

### Install a tool from the Tool Shed

- Types of repository&lt;/span&gt;
  - &lt;span style="color:orange"&gt; Tools (`$name`)&lt;/span&gt;
  - &lt;span style="color:blue"&gt; Tool suites (`suite_$name`)&lt;/span&gt;
  - &lt;span style="color:red"&gt; Tool dependencies (`package_$name_$version`)&lt;/span&gt; (gradually removed, replaced by Conda dependencies)
![](../../images/typeOfRep_ss.png)

---

### Install a tool from the Tool Shed

![](../../images/goToToolInstall_ss.png)
- Install the tool
![](../../images/launchInstallTool_ss.png)

---

### Install a tool from the Tool Shed

- Install the tool
![](../../images/installTool_ss.png)
- &lt;span style="font-size:70%"&gt; Selecting Tool Shed AND conda will make Galaxy to install both&lt;/span&gt;
- &lt;span style="font-size:70%"&gt; Recommended: use conda &lt;/span&gt;

---

### Install a tool from the Tool Shed

- Check
![](../../images/monitor_installing_toolshed_rep.png)

---

### Manage installed tools

- Admin &gt; Manage installed tools
![](../../images/manage_installed_tools.png)
![](../../images/repStatus_ss.png)

---

### Manage installed tools

- Click on the name of a tool
- Manage and browse the repository
![](../../images/managed_an_installed_tool.png)

---

## Tips: How to install workflows

---

###  How to install a workflow?

- Admin &gt; Search Tool Shed
- Search the workflow
  1. ![](../../images/toolshedWorkflow_ss.png)
  2. ![](../../images/schemaWorkflow_ss.png)
- &lt;span style="font-size:70%"&gt; Tools can come with the workflow if they are not yet installed &lt;/span&gt;

---

### How to install a workflow?

![](../../images/workflowNotInstalled_ss.png)
- No workflow?

---

###  How to install a workflow?

![](../../images/workflowInstalled_ss.png)
- Click on the imported workflow

---

###  How to install a workflow?

![](../../images/makeAvailableWorkflow_ss.png)
- Click on the workflow at the bottom of the “Contents of this repository” section

---

###  How to install a workflow?

- Repository Actions &gt; Import workflow to Galaxy

![](../../images/exportWorkflow_ss.png)

---

###  How to install a workflow?

![](../../images/workflowOK_ss.png)
- Done!

---

## 3. Tool Shed repository types

---

### 3.1 Tool with dependencies

---

###  Tool with dependencies

![](../../images/toolshedPackage.png)

---

### 3.2 Tool suite

#### Group of related repositories

---

###  Tool suite

![](../../images/toolSuite.png)

- Works but no way to install a single tool

---

###  Tool suite

![](../../images/toolsuite2.png)

- One repository per individual tool
- A special 'Tool suite' repository listing the individual repositories

---

###  Tool suite

- relationship between a dependent repository and one or more required repository (tools, datatypes, workflows,...)
- -&gt; One XML file
```xml
&lt;?xml version="1.0"?&gt;
&lt;repositories description="Pipeline phylogeny"&gt;
   &lt;repository toolshed="https://testtoolshed.g2.bx.psu.edu"
     name="fasta_to_phylip" owner="gandres" changeset_revision="a895633568" /&gt;
   &lt;repository name="mafft" owner="gandres" /&gt;
   &lt;repository name="phyml" owner="gandres" /&gt;
[…]
&lt;/repositories&gt;
```
No need to write it yourself, Planemo does it for you

---

###  Tool suite

![](../../images/toolsuite3.png)

---

### 3.3 Workflow

---


###  Workflow
![](../../images/workflow.png)
- A succession of tools to perform a complete analysis

---

###  Workflow

- In galaxy

![](../../images/galaxyWorkflowEx.png)

---

###  Workflow

![](../../images/shareWorkflow.png)

- You get a file: Galaxy-Workflow-NAME.ga

---

###  Workflow

- You have your file Galaxy-Workflow-NAME.ga
- How to automatically install the tools used in the workflow?
  - -&gt; `repository_dependencies.xml`
```xml
&lt;?xml version="1.0"?&gt;
&lt;repositories description="Phylogeny workflow"&gt;
   &lt;repository name="suite_phylogeny" owner="galaxy" /&gt;
&lt;/repositories&gt;
```

---

###  Workflow

![](../../images/workflowRepDep.png)

---

###  Workflow

![](../../images/workflowRepDep2.png)

- **Everything must be on the same toolshed**

---

## Tips

### What about tools working with *.loc files or new datatypes

---

### Tools with `*.loc` files or new datatypes

- add them to the Tool Shed repository.
- `*.loc` files and `datatypes` files should be provided as `*.sample` file in a `tool-data` directory.
- `tool-data/*.loc.sample` files come along with `tool_data_table_conf.xml.sample`.

Their content or the file themselves are put to the right location on tool set up.

---

### Tools with *.loc files or new datatypes

![](../../images/repWithLoc_ss.png)

&lt;span style="font-size:60%"&gt;`tool_data_table_conf.xml.sample`&lt;/span&gt;
```xml
&lt;tables&gt;
	&lt;!-- Locations of indexes in the Bowtie2 mapper format --&gt;
	&lt;table name="bowtie2_indexes" comment_char="#"&gt;
		&lt;columns&gt;value, dbkey, name, path&lt;/columns&gt;
		&lt;file path="tool-data/bowtie2_indices.loc" /&gt;
	&lt;/table&gt;
&lt;/tables&gt;
```
&lt;span style="font-size:60%"&gt;On install, the content of the file and the right
path to the *.loc file is added to `shed_tool_data_table_conf.xml`&lt;/span&gt;

---

## 4. Publishing with Planemo

---

### Configure the target Tool Shed

```bash
planemo config_init
```
- Creates `.planemo.yml` file in your home directory:

```yml
## Planemo Global Configuration File.
## Everything in this file is completely optional - these values can all be
## configured via command line options for the corresponding commands.
## [...]
sheds:
     toolshed:
           #key: "&lt;TODO&gt;"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
     testtoolshed:
           #key: "&lt;TODO&gt;"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
     local:
           #key: "&lt;TODO&gt;"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
```

---

### Configure the target Tool Shed

- Add your Tool Shed API key in `.planemo.yml`

```yml
## Planemo Global Configuration File.
## Everything in this file is completely optional - these values can all be
## configured via command line options for the corresponding commands.
## [...]
sheds:
     toolshed:
           key: "xxxxxxxxxmytoolshedAPIkeyxxxxxxx"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
     testtoolshed:
           #key: "&lt;TODO&gt;"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
     local:
           #key: "&lt;TODO&gt;"
           #email: "&lt;TODO&gt;"
           #password: "&lt;TODO&gt;"
```

---

### Configure repository

```bash
planemo shed_init --name="tandem_repeats_finder_2"
                     --owner="gandres"
                     --description="Tandem Repeats Finder description"
                     --long_description="A long long description."
                     --category="Sequence Analysis"
                     [--remote_repository_url=&lt;URL to .shed.yml on github&gt;]
                     [--homepage_url=&lt;Homepage for tool.&gt;]
```
- Creates `.shed.yml` file in the current repository (tool repository):

```yml
categories: [Sequence Analysis]
description: Tandem Repeats Finder description
long_description: A long long description.
name: tandem_repeats_finder_2
owner: gandres
```

---

### Configure repository

#### Naming conventions
&lt;small&gt;

| Repository Type | Recommended Name         | Examples                 |
| --------------- |--------------------------| -------------------------|
| Data Managers   | `data_manager_$name`     | `data_manager_bowtie2`   |
| Packages        | `package_$name_$version` | `package_aragorn_1_2_36` |
| Tool Suites     | `suite_$name`            | `suite_samtools`         |
| Tools           | `$name`                  | `stringle`, `bowtie2`    |

&lt;/small&gt;
&lt;span style="color:red"&gt;Planemo will determine the repository type based on these conventions&lt;/span&gt;

---

### Configure repository

- Tools and tool suite `.shed.yml`: implicitly define repositories for each individual tool in the directory and build a suite for those tools.

- Example: `trinity/.shed.yml`

```yml
[...]
auto_tool_repositories:
    name_template: ""
    description_template: " (from the Trinity tool suite)"
suite:
    name: "suite_trinity"
    description: Trinity tools to assemble transcript sequences from Illumina RNA-Seq data.
```

---

### Check

```bash
planemo shed_lint --tools
```
```bash
Linting repository […]/tandem_repeats_finder
Applying linter expansion... CHECK
.. INFO: Included files all found.
Applying linter tool_dependencies_xsd... CHECK
.. INFO: tool_dependencies.xml found and appears to be valid XML
Applying linter tool_dependencies_actions... CHECK
.. INFO: Parsed tool dependencies.
Applying linter repository_dependencies... CHECK
.. INFO: No repository_dependencies.xml, skipping.
Applying linter shed_yaml... CHECK
.. INFO: .shed.yml found and appears to be valid YAML.
Applying linter readme... CHECK
.. INFO: No README found skipping.
+Linting tool […]/tandem_repeats_finder/tandem_repeats_finder_wrapper.xml
[…]
```

---

### Create repository

```bash
planemo shed_create --shed_target testtoolshed
```
- Don't forget **--shed_target**. Default is main toolshed

---

### Create repository

```bash
planemo shed_create --shed_target testtoolshed
```
```bash
Repository created
cd '[…]/tandem_repeats_finder' &amp;&amp; git rev-parse HEAD
Repository tandem_repeats_finder_2 updated successfully.
```
![](../../images/shedCreate.png)

---

### Update repository

```bash
planemo shed_diff --shed_target testtoolshed

```
```bash
wget -q --recursive -O - 'https://testtoolshed.g2.bx.psu.edu/repository/download?repository_id=6306166e4da9a8bf&amp;changeset_revision=default&amp;file_type=gz' | tar -xzf - -C /tmp/tool_shed_diff_DMcOrR/_testtoolshed_ --strip-components 1
mkdir "/tmp/tool_shed_diff_DMcOrR/_local_"; tar -xzf "/tmp/tmp5ousfg" -C "/tmp/tool_shed_diff_DMcOrR/_local_"; rm -rf /tmp/tmp5ousfg
cd "/tmp/tool_shed_diff_DMcOrR"; diff -r _local_ _testtoolshed_
diff -r _local_/tandem_repeats_finder.xml _testtoolshed_/tandem_repeats_finder.xml
41d40
&lt;     &lt;param name="fileout_label2" type="text" value="Unused" label="none" help="Output name for files" /&gt;
```
- The repository needs to be updated

---

### Update repository

```bash
planemo shed_update --check_diff --shed_target testtoolshed

```
```bash
wget -q --recursive -O - 'https://testtoolshed.g2.bx.psu.edu/repository/download?repository_id=6306166e4da9a8bf&amp;changeset_revision=default&amp;file_type=gz' | tar -xzf - -C /tmp/tool_shed_diff_DMcOrR/_testtoolshed_ --strip-components 1
mkdir "/tmp/tool_shed_diff_DMcOrR/_local_"; tar -xzf "/tmp/tmp5ousfg" -C "/tmp/tool_shed_diff_DMcOrR/_local_"; rm -rf /tmp/tmp5ousfg
cd "/tmp/tool_shed_diff_DMcOrR"; diff -r _local_ _testtoolshed_
diff -r _local_/tandem_repeats_finder.xml _testtoolshed_/tandem_repeats_finder.xml
41d40
&lt;     &lt;param name="fileout_label2" type="text" value="Unused" label="none" help="Output name for files" /&gt;
Repository tandem_repeats_finder updated successfully.
Repository metadata updated.
```
- The repository has been updated

---

### Update repository
```bash
planemo shed_update --check_diff --shed_target testtoolshed

```
![](../../images/checkToolUpdate.png)

- The repository has been updated

---

![](../../images/planemo-logo.png)
#### Publishing to the Tool Shed

![](../../images/planemo_toolshed_publishing.png)

---

![](../../images/planemo-logo.png)

&gt; Command-line utilities to assist in building and publishing Galaxy tools.

---

![](../../images/planemo-logo.png)

![](../../images/big_picture.png)

---

![](../../images/planemo-logo.png)

#### Checklist (3/3)

&lt;p style="text-align: left;"&gt;
  &lt;input type="checkbox"/&gt; Initiate the `.shed.yml` file with &lt;br/&gt;
  ```planemo shed_init``` &lt;br/&gt;
  &lt;input type="checkbox"/&gt; Create the repository on ToolShed with &lt;br/&gt;
  ```planemo shed_create```&lt;br/&gt;
  &lt;input type="checkbox"/&gt; Install and test the wrapper on a Galaxy instance &lt;br/&gt;
  &lt;input type="checkbox"/&gt; Improve the wrapper and push modification on toolshed &lt;br/&gt;
  ```planemo shed_update``` &lt;br/&gt;
&lt;/p&gt;

---

## 6. Contributing to a community

---

### Contributing to a community

Many tools developped by the community on GitHub repositories
- [Intergalactic Utilities Commission](https://github.com/galaxyproject/tools-iuc)
- [GalaxyP](https://github.com/galaxyproteomics/tools-galaxyp)
- ...

Added value:
- Easier development for developers
- Easier contribution for user
- Automated tests on each contribution
- Automated publishing to ToolShed

---

### Intergalactic Utilities Commission (IUC)

Develops high quality Galaxy tools

Establishes and follows [best practices](https://galaxy-iuc-standards.readthedocs.io/en/latest/)

---

### How should I publish my tool?

Using an existing GitHub repository

- Open a pull request
- Follow the guidelines and comments from maintainers

---

### How should I publish my tool?

Using your own GitHub repository

- Reasons: ownership, specific practices, exotic tools
- Follow the same structure
- Use `.travis.yml` to automate tests and publishing

---

### How should I publish my tool?

Using planemo by hand

- Ok for few tools
- Makes contributing harder

---

## References

- [ToolShed](https://galaxyproject.org/toolshed/tour/)
- [Install tools from the ToolShed](https://galaxyproject.org/admin/tools/add-tool-from-toolshed-tutorial/)
- [Publish tools with Planemo](https://planemo.readthedocs.io/en/latest/)

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

![](../../images/exercise.png)

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### The goal
Publish your tool (seqtk_seq) in your local toolshed with Planemo

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### Step 1: Start and configure your toolshed
- Start your toolshed (in galaxy home directory):
```bash
./run_tool_shed.sh
```
- Toolshed available at `http://localhost:9009`
&lt;aside class="notes"&gt;
login: galaxy/azerty
&lt;/aside&gt;

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### Step 2: Use planemo to publish your tool

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### Step 2: Use planemo to publish your tool
- `planemo config_init`
- `planemo shed_init`
- `planemo shed_lint`
- `planemo shed_create`

&lt;aside class="notes"&gt;
```bash
planemo config_init
```
  - Creates file `.planemo.yml` in your home directory.
```yml
[...]  local:
#key: "&lt;TODO&gt;"
email: "galaxy@localhost.fr"
password: "azerty"
```
```bash
planemo shed_init --name=seqtk_seq --owner=galaxy --description="common transformation of FASTA/Q" --category="Fasta Manipulation"
```
```bash
planemo shed_lint .
```
```bash
planemo shed_create --shed_target local
```

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### Step 3: Update your tool and then use planemo to update your tool on the Tool Shed

---

### &lt;i class="fa fa-pencil" aria-hidden="true"&gt;&lt;/i&gt; Hands-on

#### Step 3: Update your tool and then use planemo to update your tool on the Tool Shed
- `planemo shed_diff`
- `planemo shed_update`

&lt;aside class="notes"&gt;
```bash
planemo shed_diff --shed_target local
```
```bash
planemo shed_update --check_diff --shed_target local
```
&lt;/aside&gt;

---

### &lt;i class="fa fa-exclamation-circle" aria-hidden="true"&gt;&lt;/i&gt; Key points

- Use Planemo
- Contribute to the Main Tool Shed


---

### <img class="emoji" title=":grey_exclamation:" alt=":grey_exclamation:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2755.png" height="20" width="20"> Key points


- Use Planemo

- Contribute to the Main Tool Shed



---

## Thank you!

This material is the result of a collaborative work. Thanks the [Galaxy Training Network](https://wiki.galaxyproject.org/Teach/GTN) and all the contributors  (Anthony Bretaudeau, Loraine Guéguen, Stéphanie Legras, Bérénice Batut) !


<img src="/training-material/assets/images/GTN.png" alt="Galaxy Training Network" style="height: 100px;">



.footnote[Found a typo? Something is wrong in this tutorial? <br>Edit it on [GitHub](https://github.com/galaxyproject/training-material/tree/master/topics/dev/tutorials/toolshed/slides.html)]

    </textarea>
    <script src="/training-material/assets/js/remark-latest.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({navigation: {scroll: false,}});
      var hljs = remark.highlighter.engine;
    </script>
  </body>
</html>
